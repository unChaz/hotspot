<h3><%= @location.name %><% if user_admin? %>
<%= link_to 'Edit', edit_location_path(@location), :class => "btn btn-info" %>
</div>
<% end %></h3>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
	<script>

	var directionsDisplay;
 	var directionsService = new google.maps.DirectionsService();
 
 	function initialize() {
 		directionsDisplay = new google.maps.DirectionsRenderer();
 		directionsDisplay.setPanel(document.getElementById('directions-panel'));
 
 		var control = document.getElementById('control');
 		control.style.display = 'block';
 		map.controls[google.maps.ControlPosition.TOP_CENTER].push(control);
 	}
 
 	function calcRoute() {
 		var start = document.getElementById('start').value;
 		var end = "<%=@location.lat%>, <%=@location.long%>";
 		var request = {
 			origin : start,
 			destination : end,
 			travelMode : google.maps.TravelMode.DRIVING
 		};
 		directionsService.route(request, function(response, status) {
 			if (status == google.maps.DirectionsStatus.OK) {
 				directionsDisplay.setDirections(response);
 			}
 		});
 		document.getElementById("print-button").style.visibility="visible";
 	}
 	function print(){
 		var contents = window.document.getElementById('directions-panel'); 
 		newWindow= window.open();
 		newWindow.document.write(contents.innerHTML);
 		newWindow.print();
 		newWindow.close();
     }
 	google.maps.event.addDomListener(window, 'load', initialize);
 	</script>
 	<script>
 	function showDirections()
 	{
 		document.getElementById("directionsWidget").style.visibility="visible";
 		document.getElementById("hideDirections").style.visibility="visible";
 	}
 	function hideDirections()
 	{
 		document.getElementById("directionsWidget").style.visibility="hidden";
 		document.getElementById("hideDirections").style.visibility="hidden";
 		document.getElementById("print-button").style.visibility="hidden";
 	}			
		
	</script>
<div class="row">
  <div class="col-md-6">
    <div id="map-canvas" class="minimap"></div>
	<script>
		document.write("<div class='fb-comments' data-href='" + window.location.href + "' data-num-posts='2' data-width='500'></div>");
	</script>
  </div>
  <div class="col-md-6">
    <div class="well"><%= @location.description %></div>
	<div align="center" style="padding-bottom: 10px">
		<button id="getDirections" class="btn btn-large btn-primary" onClick="showDirections()">
		<span class="glyphicon glyphicon-road"></span>
		<span class="text">Get Directions</span>
		</button>
		<button id="hideDirections" style="visibility: hidden;" class="btn btn-large btn-primary" onClick="hideDirections()">
		<span class="glyphicon glyphicon-remove"></span>
		<span class="text">Hide Directions</span>
		</button>
		
		<button id="print-button" style="visibility: hidden;"  class="btn btn-mini btn-primary" onClick="print()">
 		<span class="glyphicon glyphicon-print"></span>
 		<span class="text">Print</span>
 		</button>
	</div>
	
		<div id="directionsWidget" style="visibility: hidden">
 			<div id="control">
 				<strong>Start:</strong>
 				<input name="start" type="text" maxlength="100" id="start"/>
 				<strong>End:</strong>
 				<input name="end" type="text" maxlength="100" id="end" value="<%=@location.name%>" readonly/>
 				<input type="button" value="Go!" onClick="calcRoute()">
 			</div>
 			<div id="directions-panel"></div>
 		</div>
  </div>
</div>


<div class="row gallery-row">
  <% unless @location.image1.blank? %>
    <div class="col-xs-6 col-md-3 gallery-thumb">
      <a href="#" class="thumbnail" data-toggle="modal" data-target="#image1Modal">
      <%= image_tag @location.image1.url(:medium) %>
      </a>
    </div>
  <% end %>
  <% unless @location.image2.blank? %>
    <div class="col-xs-6 col-md-3 gallery-thumb">
      <a href="#" class="thumbnail" data-toggle="modal" data-target="#image2Modal">
      <%= image_tag @location.image2.url(:medium) %>
      </a>
    </div>
  <% end %>
  <% unless @location.image3.blank? %>
    <div class="col-xs-6 col-md-3 gallery-thumb">
      <a href="#" class="thumbnail" data-toggle="modal" data-target="#image3Modal">
      <%= image_tag @location.image3.url(:medium) %>
      </a>
    </div>
  <% end %>
  <% unless @location.image4.blank? %>
    <div class="col-xs-6 col-md-3 gallery-thumb">
      <a href="#" class="thumbnail" data-toggle="modal" data-target="#image4Modal">
      <%= image_tag @location.image4.url(:medium) %>
      </a>
    </div>
  <% end %>
</div>

<% @user_uploaded_images.each do |photo| %>
  <%= image_tag photo.image.url(:medium) %>
<% end %>

<%= form_for(@new_image) do |f| %>

  <%= f.text_field :location_id, :value => @location.id, :class => "hidden"  %>
  <%= f.file_field :image %>
  <div class="actions">
    <%= f.submit 'Add Photo', :class => 'btn btn-success' %>
  </div>
<% end %>


<% unless @location.image1.blank? %>
  <div class="modal fade" id="image1Modal" tabindex="-1" role="dialog" aria-labelledby="image1Modal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <%= image_tag @location.image1.url %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% unless @location.image2.blank? %>
  <div class="modal fade" id="image2Modal" tabindex="-1" role="dialog" aria-labelledby="image2Modal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <%= image_tag @location.image2.url %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% unless @location.image3.blank? %>
  <div class="modal fade" id="image3Modal" tabindex="-1" role="dialog" aria-labelledby="image3Modal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <%= image_tag @location.image3.url %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% unless @location.image4.blank? %>
  <div class="modal fade" id="image4Modal" tabindex="-1" role="dialog" aria-labelledby="image4Modal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <%= image_tag @location.image4.url %>
        </div>
      </div>
    </div>
  </div>
<% end %>
<div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=249607688534353";
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>


<script type="text/javascript">
window.hotspot.useCurrentLocation = false;
window.hotspot.initialize();
function loadScript() {
  window.hotspot.addMarkerIconToMap(<%= @location.lat %>, <%= @location.long %>);
  window.hotspot.setCenter(<%= @location.lat %>, <%= @location.long %>);
  window.hotspot.map.setZoom(15);
}
window.onload = loadScript;
</script>
